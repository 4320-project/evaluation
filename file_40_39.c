int write_log_entry_safe(FILE *log_file, const char *format, ...) { va_list args; char buffer[MAX_LOG_ENTRY_SIZE]; int result; if (log_file == NULL || format == NULL) { return -1; } va_start(args, format); result = vsnprintf(buffer, sizeof(buffer), format, args); va_end(args); if (result < 0 || (size_t)result >= sizeof(buffer)) { return -1; } char *newline_pos; while ((newline_pos = strchr(buffer, ' ')) != NULL) { *newline_pos = ' '; } if (fprintf(log_file, "%s ", buffer) < 0) { return -1; } return 0; }