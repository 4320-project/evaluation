msg_receive_cb(char *word[],void *userdata) { xchat_context *curr_ctx,*ctx; const char *ircchannel,*ircserver; char src_ircchannel[MAX_CHANNEL_NAME_SIZE]; char src_ircserver[MAX_SERVER_NAME_SIZE]; char cmp_ircchannel[MAX_CHANNEL_NAME_SIZE]; char *nickptr; char *callsign; if(cwirc_is_cw_frame(word[2])) { if(plugin_enabled) { if((ircchannel=xchat_get_info(ph,"channel"))==NULL) return(XCHAT_EAT_ALL); strncpy(src_ircchannel,ircchannel,MAX_CHANNEL_NAME_SIZE); src_ircchannel[MAX_CHANNEL_NAME_SIZE-1]=0; if((ircserver=xchat_get_info(ph,"server"))==NULL) return(XCHAT_EAT_ALL); strncpy(src_ircserver,ircserver,MAX_SERVER_NAME_SIZE); src_ircserver[MAX_SERVER_NAME_SIZE-1]=0; if(!locked_channel[0]) { if((curr_ctx=xchat_get_context(ph))==NULL) return(XCHAT_EAT_ALL); if((ctx=xchat_find_context(ph,NULL,NULL))==NULL) return(XCHAT_EAT_ALL); if(!xchat_set_context(ph,ctx)) return(XCHAT_EAT_ALL); if((ircchannel=xchat_get_info(ph,"channel"))==NULL) return(XCHAT_EAT_ALL); strncpy(cmp_ircchannel,ircchannel,MAX_CHANNEL_NAME_SIZE); cmp_ircchannel[MAX_CHANNEL_NAME_SIZE-1]=0; ircchannel=cmp_ircchannel; if((ircserver=xchat_get_info(ph,"server"))==NULL) return(XCHAT_EAT_ALL); if(!xchat_set_context(ph,curr_ctx)) return(XCHAT_EAT_ALL); } else { ircchannel=locked_channel; ircserver=locked_server; } nickptr=word[1]; if(nickptr[0]==3) while(isdigit((++nickptr)[0])); if(!strcmp(src_ircchannel,ircchannel) && !strcmp(src_ircserver,ircserver)) { if(cwirc_decode_cw_frame(nickptr,word[2],&callsign)==1) { if(callsign!=NULL) xchat_printf(ph, "Receiving cw from %s [from %s] ... ",callsign, nickptr); else xchat_printf(ph, "Receiving cw from %s ... ",nickptr); } } } return(XCHAT_EAT_ALL); } return(XCHAT_EAT_NONE); }