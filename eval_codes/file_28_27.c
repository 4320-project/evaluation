xmlParserInputBufferPtr xmlNewInputBufferMemory(const void *mem, size_t size, int flags, xmlCharEncoding enc) { xmlParserInputBufferPtr ret; xmlMemIOCtxt *ctxt; char *copy = NULL; if ((flags & XML_INPUT_BUF_STATIC) == 0) { if (size + 1 == 0) return(NULL); copy = xmlMalloc(size + 1); if (copy == NULL) return(NULL); memcpy(copy, mem, size); copy[size] = 0; mem = copy; } ret = xmlAllocParserInputBuffer(enc); if (ret == NULL) { xmlFree(copy); return(NULL); } ctxt = xmlMalloc(sizeof(*ctxt)); if (ctxt == NULL) { xmlFreeParserInputBuffer(ret); xmlFree(copy); return(NULL); } ctxt->mem = copy; ctxt->cur = mem; ctxt->size = size; ret->context = ctxt; ret->readcallback = xmlMemRead; ret->closecallback = xmlMemClose; return(ret); }