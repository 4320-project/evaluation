size_t safe_strlen(const char *str, size_t max_len) { if (str == NULL) return 0; size_t len = 0; while (len < max_len && str[len] != '\0') { len++; } return len; }