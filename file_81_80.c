char* secure_getline(char *buffer, size_t *size, FILE *stream) { if (buffer == NULL || size == NULL || *size == 0 || stream == NULL) { return NULL; } if (fgets(buffer, *size, stream) == NULL) { return NULL; } size_t len = strlen(buffer); while (len > 0 && buffer[len - 1] != ' ') { size_t new_size = *size * 2; char *new_buffer = realloc(buffer, new_size); if (new_buffer == NULL) { buffer[*size - 1] = '\0'; return buffer; } buffer = new_buffer; if (fgets(buffer + len, new_size - len, stream) == NULL) { *size = new_size; return buffer; } len = strlen(buffer); *size = new_size; } return buffer; }